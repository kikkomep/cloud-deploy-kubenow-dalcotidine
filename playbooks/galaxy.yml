---
- name: Installs phenomenal services
  hosts: master
  gather_facts: "no"
  vars:
    # Services
    galaxy_include: "true"
    galaxy_hostname: "galaxy"
    galaxy_generated_key: "{{lookup('password', 'galaxy-api-key length=25 chars=ascii_letters')}}"
    # Storage
    pvc_name: "galaxy-pvc"
    # Domain
    cloudflare_proxied: "false"
    proxied_suffix: ""
    # Logging
    no_sensitive_logging: "false"

  tasks:
    # Wait for all default kubernetes pods to be ready
    #- name: Wait for all default kubernetes pods to be ready
    #  include_role:
    #    name: roles/wait-for-all-pods-ready

    # Galaxy
    - name: Galaxy
      include_role:
        name: roles/galaxy
      vars:
        galaxy_chart_version: "1.5.5"
        hostname: "{{galaxy_hostname}}{{proxied_suffix}}"
        galaxy_image_tag: ":dev_v17.09-pheno-lr_cv1.6.190"
        galaxy_admin_password: "generate-random-passw"
        galaxy_admin_email: "your @ email.com"
        galaxy_api_key: "{{galaxy_generated_key}}"
        galaxy_pvc: "{{pvc_name}}"
        postgres_pvc: "{{pvc_name}}"
        nologging: "{{no_sensitive_logging}}"
      when:
        galaxy_include | bool  == true
